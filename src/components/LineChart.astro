---
interface Props {
  data: { fecha: string; value: number | null }[];
  title: string;
  color: string;
}

const { data, title, color } = Astro.props;

const maxValue = Math.max(...data.filter(d => d.value !== null).map(d => d.value || 0), 1);
const width = 1000;
const height = 150;
const padding = { top: 20, right: 20, bottom: 30, left: 50 };
const chartWidth = width - padding.left - padding.right;
const chartHeight = height - padding.top - padding.bottom;

const points = data.map((d, i) => {
  const x = (i / (data.length - 1)) * chartWidth;
  const y = d.value !== null ? chartHeight - (d.value / maxValue) * chartHeight : null;
  return { x, y, value: d.value, fecha: d.fecha };
}).filter(p => p.y !== null);

const pathData = points.map((p, i) =>
  `${i === 0 ? 'M' : 'L'} ${p.x + padding.left} ${p.y! + padding.top}`
).join(' ');
---

<div class="line-chart">
  <h3>{title}</h3>
  <svg viewBox={`0 0 ${width} ${height}`} class="chart-svg" preserveAspectRatio="none">
    <!-- Líneas de grid -->
    <line
      x1={padding.left}
      y1={padding.top}
      x2={padding.left}
      y2={height - padding.bottom}
      stroke="#fff3"
      stroke-width="1"
    />
    <line
      x1={padding.left}
      y1={height - padding.bottom}
      x2={width - padding.right}
      y2={height - padding.bottom}
      stroke="#fff3"
      stroke-width="1"
    />

    <!-- Línea de datos -->
    {pathData && (
      <path
        d={pathData}
        fill="none"
        stroke={color}
        stroke-width="2"
      />
    )}

    <!-- Puntos -->
    {points.map(p => (
      <circle
        cx={p.x + padding.left}
        cy={p.y! + padding.top}
        r="3"
        fill={color}
      />
    ))}

    <!-- Etiquetas eje Y -->
    <text x={padding.left - 10} y={padding.top} text-anchor="end" font-size="10" fill="#888" font-family="Monaco, 'Courier New', monospace">
      {maxValue}
    </text>
    <text x={padding.left - 10} y={height - padding.bottom} text-anchor="end" font-size="10" fill="#888" font-family="Monaco, 'Courier New', monospace">
      0
    </text>
  </svg>
</div>

<style>
.line-chart{margin-bottom:1rem}.line-chart h3{margin:0 0 .5rem 0;font:700 11px/1.2 Monaco,'Courier New',Courier,monospace;text-transform:uppercase;letter-spacing:.05em;color:var(--a)}.chart-svg{background:transparent;width:100%;height:auto}
</style>
